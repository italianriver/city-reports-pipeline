
<!-- Important note: This code is largely generated by an LLM -->

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Amsterdam Incident Reports Map</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

  <style>
      #map { height: 100vh; width: 100%; }
  </style>
</head>
<body>

<div id="map"></div>

<script>
// 1. Initialise map
const map = L.map('map').setView([52.37, 4.89], 12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
}).addTo(map);

// 2. URL to Azure GeoJSON
// Temp read-only SAS key
const url = "https://storagegemeente.blob.core.windows.net/consumption/reports.geojson?sp=r&st=2025-12-16T10:12:28Z&se=2025-12-18T18:27:28Z&spr=https&sv=2024-11-04&sr=b&sig=tedksjOzlRGHUDTD4CgTAlnejnPYOl4r5zR%2BeODy4EQ%3D";

// 3. Color function based on priority
function getColor(priority) {
    if (!priority) return "#000000";
    const p = priority.toLowerCase();

    if (p === "hoog") return "#FF0000";     // red
    if (p === "middel") return "#FFA500";   // orange
    if (p === "laag") return "#FFD700";     // yellow

    return "#000000";
}

// 4. Load + display GeoJSON
function loadData() {
    fetch(url + "&t=" + Date.now())
        .then(r => r.json())
        .then(data => {

            // Remove old layer
            if (window.layer) map.removeLayer(window.layer);

            // Add new layer
            window.layer = L.geoJSON(data, {

                pointToLayer: function(feature, latlng) {
                    const props = feature.properties;
                    const color = getColor(props.priority);

                    return L.circleMarker(latlng, {
                        radius: 8,
                        fillColor: color,
                        color: "#000",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.8
                    });
                },

                onEachFeature: function(feature, layer) {
                    const p = feature.properties;

                    const popup = `
                        <b>Probleem Nummer:</b> ${p.id}<br>
                        <b>Probleem:</b> ${p.problem}<br>
                        <b>Prioriteit:</b> ${p.priority}<br>
                        <b>Straatnaam:</b> ${p.street_name}<br>
                        <b>Huisnummer:</b> ${p.house_number}<br>
                        <b>Postcode:</b> ${p.postcode}<br>
                        <b>Datum Gemeld:</b> ${p.reported_on}<br>
                    `;

                    layer.bindPopup(popup);
                }

            }).addTo(map);

        })
        .catch(err => console.error("GeoJSON load error:", err));
}
// For demo purpose set inerval to 2-3 minutes
// minutes * seconds * miliseconds
loadData();
setInterval(loadData, 2 * 60 * 1000);

</script>

</body>
</html>
